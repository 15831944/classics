\documentclass[12pt]{book}
\title{The Aeneid}
\author{Virgil}
\date{}
\usepackage[nonumberlist,nogroupskip,nopostdot,toc]{glossaries}
\usepackage{glossary-mcols}
\usepackage[switch,modulo]{lineno}
\usepackage{everypage}
\usepackage[hang,flushmargin]{footmisc} % don't indent footnotes

% use two-column footnotes
\usepackage{dblfnote}
\DFNalwaysdouble
%\interfootnotelinepenalty=10000

\newglossary*{common}{Common Words}
\newglossary*{uncommon}{Uncommon Words}
\makeglossaries

\setglossarystyle{mcolindex}

% enable counting the words
\glsenableentrycount

% reset uncommon word counters on each page to enable footnotes
\AddEverypageHook{\glsresetall[uncommon]}

\def\perpageorderfilename{\jobname.ppo}
\def\perpageglossaryfilename{\jobname.ppg}

% track glossary entry footnote order and pagebreaks
\newcounter{IsFirstRun}
\IfFileExists{\perpageglossaryfilename}{}{\setcounter{IsFirstRun}{1}}

% only create output files on the first run
\ifnum\theIsFirstRun = 1%
    \newwrite\perpageorder
    \immediate\openout\perpageorder=\perpageorderfilename
    \AddEverypageHook{\write\perpageglossary{PAGE=\thepage}}
    \newwrite\perpageglossary
    \immediate\openout\perpageglossary=\perpageglossaryfilename
\fi

\newcommand\ftgls[1]{\let\thefootnote\relax\footnote{\textbf{\glsentryname{#1}} \glsentrydesc{#1}}}

\newcommand\glossdisplay[4]{%
    % always print the word
    \textit{#1}%
    \ifnum\pdfstrcmp{\glstype}{uncommon} = 0% only print uncommon nouns
        \ifnum\glsentrycurrcount{\glslabel} = 0% and only the first time we've seen them
            \ftgls{\glslabel}% add an unordered footnote
            \write\perpageglossary{WORD}% record that a word was added as a footnote
            \immediate\write\perpageorder{\glslabel}% record the order of the footnote glosses
        \fi
    \fi
}

\ifnum\theIsFirstRun = 1%
    \renewcommand\glsdisplayfirst[4]{\glossdisplay{#1}{#2}{#3}{#4}}
    \renewcommand\glsdisplay[4]{\glossdisplay{#1}{#2}{#3}{#4}}
\fi

%on the second run output the sorted per-page glossary
\ifnum\theIsFirstRun = 0%
    \endlinechar=256% suppress the final <return> of \read
    \newread\perpageorder
    \openin\perpageorder=\perpageorderfilename
    \renewcommand\glsdisplayfirst[4]{%
        \textit{#1}% display the text and output the ordered footnote
        \read\perpageorder to \key%
        \ftgls{\key}
    }
    \renewcommand\glsdisplay[4]{#1} % just display the text
\fi

\newcommand\newcommonterm[3]{\newglossaryentry{#1}{name={#2},description={#3},type=common}}
\newcommand\newuncommonterm[3]{\newglossaryentry{#1}{name={#2},description={#3},type=uncommon}}

% the \hspace{} command corrects the slight gap that's inserted for the missing footnote number
\newcommand\fixfootnotegap{\hspace{-0.35mm}}
\newcommand\com[2][\relax]{\textit{\glsdisp{#1}{#2}}\fixfootnotegap}
\newcommand\uncom[2][\relax]{\glsdisp{#1}{#2}\fixfootnotegap}

\newcommand\newchapter[1]{%
    %\chapter*{#1}
    %\cleardoublepage
    %\phantomsection
    %\addcontentsline{toc}{chapter}{#1}
}

\newcounter{CurrentLine}
\newcommand\lline[1]{#1\stepcounter{CurrentLine}\linebreak}

% common words
\input{commonwords.tex}

% uncommon words
\input{uncommonwords.tex}

\begin{document}

    %\maketitle
    %\tableofcontents

    %\newchapter{Introduction}
    %TODO: introduction

    \begin{linenumbers}
    \begin{flushleft}
        \input{content.tex}
    \end{flushleft}
    \end{linenumbers}

    Output \arabic{CurrentLine} lines.

    \printglossary[type=common]
    \printglossary[type=uncommon]

\end{document}

% only save files on the first run
\ifnum\theIsFirstRun = 1%
    \immediate\closeout\perpageglossary
    \immediate\closeout\perpageorder
\fi

\ifnum\theIsFirstRun = 0%
    \closein\perpageorder
\fi
